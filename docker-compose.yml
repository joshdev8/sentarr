version: '3.8'

services:
  sentarr:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: sentarr
    restart: unless-stopped
    
    ports:
      - "6500:6500"  # Web UI
    
    volumes:
      # Plex logs - Update this path!
      - /path/to/plex/config/Library/Application Support/Plex Media Server/Logs:/logs:ro
      # Optional: Persist config
      - ./config:/config
    
    environment:
      # ============================================
      # PLEX CONNECTION (Recommended)
      # ============================================
      - PLEX_API_ENABLED=true
      - PLEX_URL=http://plex:32400              # URL to your Plex server
      - PLEX_TOKEN=your-plex-token-here          # Get from: https://support.plex.tv/articles/204059436
      
      # ============================================
      # LOG MONITORING
      # ============================================
      - PLEX_LOG_PATH=/logs
      - MONITOR_ERRORS=true
      - MONITOR_WARNINGS=true
      
      # ============================================
      # ALERT THRESHOLDS
      # ============================================
      - ERROR_THRESHOLD=5                        # Errors before alerting
      - TIME_WINDOW_MINUTES=5                    # Time window to count errors
      - ALERT_COOLDOWN_MINUTES=15                # Cooldown between similar alerts
      
      # ============================================
      # EMAIL NOTIFICATIONS
      # ============================================
      - EMAIL_ENABLED=false
      - SMTP_SERVER=smtp.gmail.com
      - SMTP_PORT=587
      - SMTP_USER=your-email@gmail.com
      - SMTP_PASSWORD=your-app-password
      - EMAIL_FROM=sentarr@yourdomain.com
      - EMAIL_TO=admin@yourdomain.com
      
      # ============================================
      # DISCORD WEBHOOK
      # ============================================
      - DISCORD_ENABLED=false
      - DISCORD_WEBHOOK_URL=https://discord.com/api/webhooks/YOUR_WEBHOOK_URL
      
      # ============================================
      # SLACK WEBHOOK
      # ============================================
      - SLACK_ENABLED=false
      - SLACK_WEBHOOK_URL=https://hooks.slack.com/services/YOUR_WEBHOOK_URL
      
      # ============================================
      # CUSTOM WEBHOOK (Home Assistant, ntfy, etc)
      # ============================================
      - WEBHOOK_ENABLED=false
      - CUSTOM_WEBHOOK_URL=http://homeassistant.local:8123/api/webhook/plex_alert
    
    # Optional: Connect to Plex network for API access
    # networks:
    #   - plex
    
    # Optional: Resource limits
    deploy:
      resources:
        limits:
          cpus: '1.0'
          memory: 512M
        reservations:
          memory: 256M

# Optional: If using external Plex network
# networks:
#   plex:
#     external: true
